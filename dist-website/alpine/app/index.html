<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/alpine/app/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App - Alpine.js</title>
    <link rel="stylesheet" href="/alpine/app/public/styles/design-system.css">
    <link rel="stylesheet" href="/alpine/app/public/styles/variables.css">
    <link rel="stylesheet" href="/alpine/app/public/styles/base.css">
    <link rel="stylesheet" href="/alpine/app/public/styles/components.css">
    <link rel="stylesheet" href="/alpine/app/styles.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"></script>
</head>
<body>
    <div 
        x-data="weatherApp()"
        x-init="loadSavedLocationOrDefault()"
    >
        <header class="header">
            <div class="container">
                <h1 class="header__title">Weather Front</h1>
            </div>
        </header>

        <main class="main">
            <div class="container">
                <section class="search-section">
                    <form 
                        class="search-form" 
                        data-testid="search-form"
                        x-on:submit.prevent="handleSearch"
                    >
                        <div class="search-form__group">
                            <label for="location-input" class="sr-only">Enter city name</label>
                            <input 
                                type="text" 
                                id="location-input"
                                class="search-input" 
                                placeholder="Enter city name..."
                                data-testid="search-input"
                                autocomplete="off"
                                x-model="searchQuery"
                                x-ref="searchInput"
                            >
                            <button 
                                type="submit" 
                                class="search-button" 
                                data-testid="search-button"
                                x-bind:disabled="isLoading"
                            >
                                <span class="search-button__text" x-text="isLoading ? 'Loading...' : 'Get Weather'"></span>
                                <span class="search-button__icon">üå¶Ô∏è</span>
                            </button>
                        </div>
                    </form>
                </section>

                <div class="weather-container" data-testid="weather-container">
                    <!-- Loading State -->
                    <div 
                        class="loading" 
                        data-testid="loading" 
                        x-show="isLoading"
                        x-transition
                    >
                        <div class="loading__spinner"></div>
                        <p>Loading weather data...</p>
                    </div>

                    <!-- Error State -->
                    <div 
                        class="error" 
                        data-testid="error" 
                        x-show="hasError"
                        x-transition
                    >
                        <h2 class="error__title">Unable to load weather data</h2>
                        <p class="error__message" x-text="errorMessage">Please check the city name and try again.</p>
                    </div>

                    <!-- Weather Content -->
                    <div 
                        class="weather-content" 
                        data-testid="weather-content" 
                        x-show="hasData && !isLoading && !hasError"
                        x-transition
                    >
                        <div class="weather-layout">
                            <!-- Current Weather -->
                            <section class="current-section">
                                <h2 class="section-title">Current Weather</h2>
                                <div class="weather-card" data-testid="current-weather">
                                    <div class="current-weather">
                                        <h3 
                                            class="current-weather__location" 
                                            data-testid="current-location"
                                            x-text="currentWeather?.locationDisplay"
                                        ></h3>
                                        <div class="current-weather__main">
                                            <div 
                                                class="current-weather__icon" 
                                                data-testid="current-icon"
                                                x-text="currentWeather?.icon"
                                            >üå§Ô∏è</div>
                                            <div class="current-weather__temp-group">
                                                <div 
                                                    class="current-weather__temp" 
                                                    data-testid="current-temperature"
                                                    x-text="currentWeather?.temperature"
                                                ></div>
                                                <div 
                                                    class="current-weather__condition" 
                                                    data-testid="current-condition"
                                                    x-text="currentWeather?.condition"
                                                    x-bind:class="currentWeather?.conditionClass"
                                                ></div>
                                            </div>
                                        </div>
                                        
                                        <div class="current-weather__details">
                                            <div class="weather-detail">
                                                <div class="weather-detail__label">Feels like</div>
                                                <div 
                                                    class="weather-detail__value" 
                                                    data-testid="feels-like"
                                                    x-text="currentWeather?.feelsLike"
                                                ></div>
                                            </div>
                                            <div class="weather-detail">
                                                <div class="weather-detail__label">Humidity</div>
                                                <div 
                                                    class="weather-detail__value" 
                                                    data-testid="humidity"
                                                    x-text="currentWeather?.humidity"
                                                ></div>
                                            </div>
                                            <div class="weather-detail">
                                                <div class="weather-detail__label">Wind Speed</div>
                                                <div 
                                                    class="weather-detail__value" 
                                                    data-testid="wind-speed"
                                                    x-text="currentWeather?.windSpeed"
                                                ></div>
                                            </div>
                                            <div class="weather-detail">
                                                <div class="weather-detail__label">Pressure</div>
                                                <div 
                                                    class="weather-detail__value" 
                                                    data-testid="pressure"
                                                    x-text="currentWeather?.pressure"
                                                ></div>
                                            </div>
                                            <div class="weather-detail">
                                                <div class="weather-detail__label">Cloud Cover</div>
                                                <div 
                                                    class="weather-detail__value" 
                                                    data-testid="cloud-cover"
                                                    x-text="currentWeather?.cloudCover"
                                                ></div>
                                            </div>
                                            <div class="weather-detail">
                                                <div class="weather-detail__label">Wind Direction</div>
                                                <div 
                                                    class="weather-detail__value" 
                                                    data-testid="wind-direction"
                                                    x-text="currentWeather?.windDirection"
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Forecast -->
                            <section class="forecast-section">
                                <h2 class="section-title">7-Day Forecast</h2>
                                <div class="forecast">
                                    <div class="forecast__list" data-testid="forecast-list">
                                        <template x-for="(item, index) in forecast" :key="index">
                                            <div 
                                                class="forecast-item"
                                                data-testid="forecast-item"
                                                tabindex="0"
                                                role="button"
                                                x-bind:aria-label="`View detailed forecast for ${item.day}`"
                                                x-bind:class="{ 'active': activeForecastIndex === index }"
                                                x-on:click="toggleForecastDetails(index)"
                                                x-on:keydown.enter="toggleForecastDetails(index)"
                                                x-on:keydown.space.prevent="toggleForecastDetails(index)"
                                            >
                                                <div class="forecast-item__day" x-text="item.day"></div>
                                                <div class="forecast-item__icon" x-text="item.icon"></div>
                                                <div class="forecast-item__info">
                                                    <div class="forecast-item__condition" x-text="item.condition"></div>
                                                    <div class="forecast-item__temps" data-testid="forecast-temps">
                                                        <span class="forecast-item__high" data-testid="forecast-high" x-text="item.high"></span>
                                                        <span class="forecast-item__low" data-testid="forecast-low" x-text="item.low"></span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Forecast Details -->
                                                <div 
                                                    class="forecast-item__details"
                                                    x-show="activeForecastIndex === index"
                                                    x-transition:enter="transition ease-out duration-200"
                                                    x-transition:enter-start="opacity-0 max-h-0"
                                                    x-transition:enter-end="opacity-100 max-h-96"
                                                    x-transition:leave="transition ease-in duration-150"
                                                    x-transition:leave-start="opacity-100 max-h-96"
                                                    x-transition:leave-end="opacity-0 max-h-0"
                                                >
                                                    <div class="forecast-detail-item">
                                                        <div class="forecast-detail-item__label">Sunrise</div>
                                                        <div class="forecast-detail-item__value" x-text="item.sunrise"></div>
                                                    </div>
                                                    <div class="forecast-detail-item">
                                                        <div class="forecast-detail-item__label">Sunset</div>
                                                        <div class="forecast-detail-item__value" x-text="item.sunset"></div>
                                                    </div>
                                                    <div class="forecast-detail-item">
                                                        <div class="forecast-detail-item__label">Rain</div>
                                                        <div class="forecast-detail-item__value" x-text="item.rain"></div>
                                                    </div>
                                                    <div class="forecast-detail-item">
                                                        <div class="forecast-detail-item__label">UV Index</div>
                                                        <div class="forecast-detail-item__value" x-text="item.uvIndex"></div>
                                                    </div>
                                                    <div class="forecast-detail-item">
                                                        <div class="forecast-detail-item__label">Precipitation</div>
                                                        <div class="forecast-detail-item__value" x-text="item.precipitation"></div>
                                                    </div>
                                                    <div class="forecast-detail-item">
                                                        <div class="forecast-detail-item__label">Temperature</div>
                                                        <div class="forecast-detail-item__value" x-text="item.tempRange"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p class="footer__text">
                    Built with Alpine.js ‚Ä¢ MIT License ‚Ä¢ 
                    <a href="https://github.com/Lissy93" class="footer__link" target="_blank" rel="noopener">Alicia Sykes</a>
                </p>
            </div>
        </footer>
    </div>

    <script src="/alpine/app/js/weather-service.js"></script>
    <script src="/alpine/app/js/weather-utils.js"></script>
    <script src="/alpine/app/js/weather-app.js"></script>
</body>
</html>