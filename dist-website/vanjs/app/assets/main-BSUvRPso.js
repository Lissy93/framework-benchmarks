(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();let h=Object.getPrototypeOf,y,M,g,v,V={isConnected:1},Q=1e3,b,B={},K=h(V),x=h(h),f,U=(o,e,t,a)=>(o??(setTimeout(t,a),new Set)).add(e),O=(o,e,t)=>{let a=g;g=e;try{return o(t)}catch(r){return console.error(r),t}finally{g=a}},W=o=>o.filter(e=>e._dom?.isConnected),$=o=>b=U(b,o,()=>{for(let e of b)e._bindings=W(e._bindings),e._listeners=W(e._listeners);b=f},Q),L={get val(){return g?._getters?.add(this),this.rawVal},get oldVal(){return g?._getters?.add(this),this._oldVal},set val(o){g?._setters?.add(this),o!==this.rawVal&&(this.rawVal=o,this._bindings.length+this._listeners.length?(M?.add(this),y=U(y,this,R)):this._oldVal=o)}},N=o=>({__proto__:L,rawVal:o,_oldVal:o,_bindings:[],_listeners:[]}),S=(o,e)=>{let t={_getters:new Set,_setters:new Set},a={f:o},r=v;v=[];let n=O(o,t,e);n=(n??document).nodeType?n:new Text(n);for(let i of t._getters)t._setters.has(i)||($(i),i._bindings.push(a));for(let i of v)i._dom=n;return v=r,a._dom=n},I=(o,e=N(),t)=>{let a={_getters:new Set,_setters:new Set},r={f:o,s:e};r._dom=t??v?.push(r)??V,e.val=O(o,a,e.rawVal);for(let n of a._getters)a._setters.has(n)||($(n),n._listeners.push(r));return e},z=(o,...e)=>{for(let t of e.flat(1/0)){let a=h(t??0),r=a===L?S(()=>t.val):a===x?S(t):t;r!=f&&o.append(r)}return o},H=(o,e,...t)=>{let[{is:a,...r},...n]=h(t[0]??0)===K?t:[{},...t],i=o?document.createElementNS(o,e,{is:a}):document.createElement(e,{is:a});for(let[c,d]of Object.entries(r)){let m=p=>p?Object.getOwnPropertyDescriptor(p,c)??m(h(p)):f,E=e+","+c,w=B[E]??=m(h(i))?.set??0,_=c.startsWith("on")?(p,j)=>{let F=c.slice(2);i.removeEventListener(F,j),i.addEventListener(F,p)}:w?w.bind(i):i.setAttribute.bind(i,c),P=h(d??0);c.startsWith("on")||P===x&&(d=I(d),P=L),P===L?S(()=>(_(d.val,d._oldVal),i)):_(d)}return z(i,n)},A=o=>({get:(e,t)=>H.bind(f,o,t)}),G=(o,e)=>e?e!==o&&o.replaceWith(e):o.remove(),R=()=>{let o=0,e=[...y].filter(a=>a.rawVal!==a._oldVal);do{M=new Set;for(let a of new Set(e.flatMap(r=>r._listeners=W(r._listeners))))I(a.f,a.s,a._dom),a._dom=f}while(++o<100&&(e=[...M]).length);let t=[...y].filter(a=>a.rawVal!==a._oldVal);y=f;for(let a of new Set(t.flatMap(r=>r._bindings=W(r._bindings))))G(a._dom,S(a.f,a._dom)),a._dom=f;for(let a of t)a._oldVal=a.rawVal};const u={tags:new Proxy(o=>new Proxy(H,A(o)),A()),hydrate:(o,e)=>G(o,S(e,o)),add:z,state:N,derive:I};class J{constructor(){this.baseUrl="https://api.open-meteo.com/v1",this.geocodingUrl="https://geocoding-api.open-meteo.com/v1",this.useMockData=this.shouldUseMockData()}shouldUseMockData(){const e=navigator.userAgent.includes("Playwright")||navigator.userAgent.includes("HeadlessChrome");return window.location.search.includes("mock=false")?!1:window.location.search.includes("mock=true")||e}async getMockData(){try{this.isTestEnvironment()&&await new Promise(t=>setTimeout(t,200));const e=await fetch("./mocks/weather-data.json");if(!e.ok)throw new Error("Failed to load mock data");return await e.json()}catch(e){throw console.error("Error loading mock data:",e),e}}isTestEnvironment(){return navigator.userAgent.includes("Playwright")||navigator.userAgent.includes("HeadlessChrome")}getMockGeocodingData(e){const t={London:{latitude:51.5074,longitude:-.1278,name:"London",country:"United Kingdom"},Tokyo:{latitude:35.6762,longitude:139.6503,name:"Tokyo",country:"Japan"},Paris:{latitude:48.8566,longitude:2.3522,name:"Paris",country:"France"},"S√£o Paulo":{latitude:-23.5505,longitude:-46.6333,name:"S√£o Paulo",country:"Brazil"},"New York":{latitude:40.7128,longitude:-74.006,name:"New York",country:"United States"}};if(e.includes("Invalid")||e.includes("123")||!e.trim())throw new Error("Unable to find location. Please check the city name and try again.");return t[e]||t.London}async geocodeLocation(e){if(this.useMockData)return this.getMockGeocodingData(e);try{const t=await fetch(`${this.geocodingUrl}/search?name=${encodeURIComponent(e)}&count=1&language=en&format=json`);if(!t.ok)throw new Error("Geocoding failed");const a=await t.json();if(!a.results||a.results.length===0)throw new Error("Location not found");const r=a.results[0];return{latitude:r.latitude,longitude:r.longitude,name:r.name,country:r.country}}catch(t){throw console.error("Geocoding error:",t),new Error("Unable to find location. Please check the city name and try again.")}}async getWeatherData(e,t){if(this.useMockData)return await this.getMockData();try{const a=new URLSearchParams({latitude:e.toString(),longitude:t.toString(),daily:"temperature_2m_max,temperature_2m_min,weather_code,sunrise,sunset,rain_sum,uv_index_max,precipitation_probability_max",current:"temperature_2m,relative_humidity_2m,apparent_temperature,is_day,snowfall,showers,rain,precipitation,weather_code,cloud_cover,pressure_msl,surface_pressure,wind_direction_10m,wind_gusts_10m,wind_speed_10m",timezone:"GMT"}),r=await fetch(`${this.baseUrl}/forecast?${a}`);if(!r.ok)throw new Error(`Weather API error: ${r.status}`);return await r.json()}catch(a){throw console.error("Weather API error:",a),new Error("Unable to fetch weather data. Please try again later.")}}async getWeatherByCity(e){try{const t=await this.geocodeLocation(e);return{...await this.getWeatherData(t.latitude,t.longitude),locationName:t.name,country:t.country}}catch(t){throw console.error("Weather service error:",t),t}}}class l{static getWeatherDescription(e){return{0:"Clear sky",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Depositing rime fog",51:"Light drizzle",53:"Moderate drizzle",55:"Dense drizzle",56:"Light freezing drizzle",57:"Dense freezing drizzle",61:"Slight rain",63:"Moderate rain",65:"Heavy rain",66:"Light freezing rain",67:"Heavy freezing rain",71:"Slight snow fall",73:"Moderate snow fall",75:"Heavy snow fall",77:"Snow grains",80:"Slight rain showers",81:"Moderate rain showers",82:"Violent rain showers",85:"Slight snow showers",86:"Heavy snow showers",95:"Thunderstorm",96:"Thunderstorm with slight hail",99:"Thunderstorm with heavy hail"}[e]||"Unknown"}static getWeatherIcon(e,t=!0){return e===0?t?"‚òÄÔ∏è":"üåô":e<=3?t?"‚õÖ":"‚òÅÔ∏è":e<=48?"üå´Ô∏è":e<=57||e>=80&&e<=82||e>=61&&e<=67?"üåßÔ∏è":e>=71&&e<=77?"‚ùÑÔ∏è":e>=85&&e<=86?"üå®Ô∏è":e>=95?"‚õàÔ∏è":"üå§Ô∏è"}static formatTemperature(e){return`${Math.round(e)}¬∞C`}static formatWindSpeed(e){return`${Math.round(e)} km/h`}static formatPressure(e){return`${Math.round(e)} hPa`}static formatPercentage(e){return`${Math.round(e)}%`}static getWindDirection(e){const t=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],a=Math.round(e/22.5)%16;return t[a]}static formatDate(e){const t=new Date(e),a=new Date,r=new Date(a);return r.setDate(a.getDate()+1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===r.toDateString()?"Tomorrow":t.toLocaleDateString("en-US",{weekday:"long"})}static formatTime(e){return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}static getConditionClass(e){return e===0?"weather-condition-sunny":e<=3?"weather-condition-cloudy":e>=51&&e<=67||e>=80&&e<=82?"weather-condition-rainy":e>=95?"weather-condition-stormy":"weather-condition-cloudy"}static debounce(e,t){let a;return function(...n){const i=()=>{clearTimeout(a),e(...n)};clearTimeout(a),a=setTimeout(i,t)}}}const{div:s,header:Y,main:q,footer:X,h1:Z,h2:k,h3:ee,p:C,section:T,form:te,input:ae,button:re,label:se,span:D,a:oe}=u.tags;class ne{constructor(){this.weatherService=new J,this.searchQuery=u.state(""),this.isLoading=u.state(!1),this.hasError=u.state(!1),this.errorMessage=u.state(""),this.weatherData=u.state(null),this.activeForecastIndex=u.state(null),this.init()}async init(){await this.loadSavedLocationOrDefault()}createSearchComponent(){const e=a=>{this.searchQuery.val=a.target.value};return T({class:"search-section"},te({class:"search-form","data-testid":"search-form",onsubmit:async a=>{a.preventDefault();const r=this.searchQuery.val.trim();if(!r){this.showError("Please enter a city name");return}await this.loadWeather(r)}},s({class:"search-form__group"},se({for:"location-input",class:"sr-only"},"Enter city name"),ae({type:"text",id:"location-input",class:"search-input",placeholder:"Enter city name...","data-testid":"search-input",autocomplete:"off",value:()=>this.searchQuery.val,oninput:e}),re({type:"submit",class:"search-button","data-testid":"search-button",disabled:()=>this.isLoading.val},D({class:"search-button__text"},()=>this.isLoading.val?"Loading...":"Get Weather"),D({class:"search-button__icon"},"üå¶Ô∏è")))))}createLoadingComponent(){return s({class:"loading","data-testid":"loading"},s({class:"loading__spinner"}),C("Loading weather data..."))}createErrorComponent(){return s({class:"error","data-testid":"error"},k({class:"error__title"},"Unable to load weather data"),C({class:"error__message"},()=>this.errorMessage.val||"Please check the city name and try again."))}createForecastItem(e,t){const a=l.formatDate(e.time[t]),r=e.weather_code[t],n=e.temperature_2m_max[t],i=e.temperature_2m_min[t],c=l.getWeatherDescription(r),d=l.getWeatherIcon(r),m=()=>{this.activeForecastIndex.val===t?this.activeForecastIndex.val=null:this.activeForecastIndex.val=t},E=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),m())},w=()=>this.activeForecastIndex.val===t;return s({class:()=>`forecast-item ${w()?"active":""}`,"data-testid":"forecast-item",tabindex:"0",role:"button","aria-label":`View detailed forecast for ${a}`,onclick:m,onkeydown:E},s({class:"forecast-item__day"},a),s({class:"forecast-item__icon"},d),s({class:"forecast-item__info"},s({class:"forecast-item__condition"},c),s({class:"forecast-item__temps","data-testid":"forecast-temps"},D({class:"forecast-item__high","data-testid":"forecast-high"},l.formatTemperature(n)),D({class:"forecast-item__low","data-testid":"forecast-low"},l.formatTemperature(i)))),()=>w()?this.createForecastDetails(e,t):"")}createForecastDetails(e,t){const a=e.sunrise[t],r=e.sunset[t],n=e.rain_sum[t],i=e.uv_index_max[t],c=e.temperature_2m_min[t],d=e.temperature_2m_max[t],m=e.precipitation_probability_max[t];return s({class:"forecast-item__details"},s({class:"forecast-detail-item"},s({class:"forecast-detail-item__label"},"Sunrise"),s({class:"forecast-detail-item__value"},l.formatTime(a))),s({class:"forecast-detail-item"},s({class:"forecast-detail-item__label"},"Sunset"),s({class:"forecast-detail-item__value"},l.formatTime(r))),s({class:"forecast-detail-item"},s({class:"forecast-detail-item__label"},"Rain"),s({class:"forecast-detail-item__value"},`${n?.toFixed(1)||0} mm`)),s({class:"forecast-detail-item"},s({class:"forecast-detail-item__label"},"UV Index"),s({class:"forecast-detail-item__value"},i?.toFixed(1)||0)),s({class:"forecast-detail-item"},s({class:"forecast-detail-item__label"},"Precipitation"),s({class:"forecast-detail-item__value"},l.formatPercentage(m||0))),s({class:"forecast-detail-item"},s({class:"forecast-detail-item__label"},"Temperature"),s({class:"forecast-detail-item__value"},`${l.formatTemperature(c)} to ${l.formatTemperature(d)}`)))}createForecastComponent(){return()=>{const e=this.weatherData.val;if(!e?.daily?.time)return"";const{daily:t}=e;return T({class:"forecast-section"},k({class:"section-title"},"7-Day Forecast"),s({class:"forecast"},s({class:"forecast__list","data-testid":"forecast-list"},...t.time.map((a,r)=>this.createForecastItem(t,r)))))}}createCurrentWeatherComponent(){return()=>{const e=this.weatherData.val;if(!e)return"";const{current:t,locationName:a,country:r}=e;return T({class:"current-section"},k({class:"section-title"},"Current Weather"),s({class:"weather-card","data-testid":"current-weather"},s({class:"current-weather"},ee({class:"current-weather__location","data-testid":"current-location"},`${a}${r?`, ${r}`:""}`),s({class:"current-weather__main"},s({class:"current-weather__icon","data-testid":"current-icon"},l.getWeatherIcon(t.weather_code,t.is_day)),s({class:"current-weather__temp-group"},s({class:"current-weather__temp","data-testid":"current-temperature"},l.formatTemperature(t.temperature_2m)),s({class:`current-weather__condition ${l.getConditionClass(t.weather_code)}`,"data-testid":"current-condition"},l.getWeatherDescription(t.weather_code)))),s({class:"current-weather__details"},s({class:"weather-detail"},s({class:"weather-detail__label"},"Feels like"),s({class:"weather-detail__value","data-testid":"feels-like"},l.formatTemperature(t.apparent_temperature))),s({class:"weather-detail"},s({class:"weather-detail__label"},"Humidity"),s({class:"weather-detail__value","data-testid":"humidity"},l.formatPercentage(t.relative_humidity_2m))),s({class:"weather-detail"},s({class:"weather-detail__label"},"Wind Speed"),s({class:"weather-detail__value","data-testid":"wind-speed"},l.formatWindSpeed(t.wind_speed_10m))),s({class:"weather-detail"},s({class:"weather-detail__label"},"Pressure"),s({class:"weather-detail__value","data-testid":"pressure"},l.formatPressure(t.pressure_msl))),s({class:"weather-detail"},s({class:"weather-detail__label"},"Cloud Cover"),s({class:"weather-detail__value","data-testid":"cloud-cover"},l.formatPercentage(t.cloud_cover))),s({class:"weather-detail"},s({class:"weather-detail__label"},"Wind Direction"),s({class:"weather-detail__value","data-testid":"wind-direction"},l.getWindDirection(t.wind_direction_10m)))))))}}createWeatherDisplayComponent(){return()=>this.isLoading.val?this.createLoadingComponent():this.hasError.val?this.createErrorComponent():this.weatherData.val?s({class:"weather-content","data-testid":"weather-content"},s({class:"weather-layout"},this.createCurrentWeatherComponent(),this.createForecastComponent())):""}createApp(){return s({style:{display:"flex",flexDirection:"column",minHeight:"100vh",fontFamily:"var(--font-family-sans)",background:"var(--color-background)",color:"var(--color-text)",lineHeight:"var(--line-height-normal)"}},Y({class:"header"},s({class:"container"},Z({class:"header__title"},"Weather Front"))),q({class:"main"},s({class:"container"},this.createSearchComponent(),s({class:"weather-container","data-testid":"weather-container"},this.createWeatherDisplayComponent()))),X({class:"footer"},s({class:"container"},C({class:"footer__text"},"Built with VanJS ‚Ä¢ MIT License ‚Ä¢ ",oe({href:"https://github.com/Lissy93",class:"footer__link",target:"_blank",rel:"noopener"},"Alicia Sykes")))))}async loadWeather(e){try{this.setLoading(!0),this.clearError(),this.weatherData.val=await this.weatherService.getWeatherByCity(e),this.saveLocation(e),this.showWeatherContent()}catch(t){this.showError(t.message)}finally{this.setLoading(!1)}}async loadSavedLocationOrDefault(){try{const e=this.getSavedLocation();if(e){this.searchQuery.val=e,await this.loadWeather(e);return}}catch(e){console.warn("Could not load saved location:",e)}try{await this.getCurrentLocationWeather()}catch(e){console.warn("Could not get current location:",e),this.searchQuery.val="London",await this.loadWeather("London")}}getCurrentLocationWeather(){return new Promise((e,t)=>{if(!navigator.geolocation){t(new Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(async a=>{try{this.setLoading(!0),this.clearError();const{latitude:r,longitude:n}=a.coords;this.weatherData.val=await this.weatherService.getWeatherData(r,n),this.weatherData.val.locationName="Current Location",this.searchQuery.val="Current Location",this.showWeatherContent(),e()}catch(r){t(r)}finally{this.setLoading(!1)}},a=>{t(a)},{timeout:1e4,enableHighAccuracy:!1,maximumAge:3e5})})}setLoading(e){this.isLoading.val=e}showError(e){this.hasError.val=!0,this.weatherData.val=null,this.errorMessage.val=e}clearError(){this.hasError.val=!1,this.errorMessage.val=""}showWeatherContent(){this.hasError.val=!1}saveLocation(e){try{localStorage.setItem("weather-app-location",e)}catch(t){console.warn("Could not save location to localStorage:",t)}}getSavedLocation(){try{return localStorage.getItem("weather-app-location")}catch(e){return console.warn("Could not get saved location from localStorage:",e),null}}}const ie=new ne;u.add(document.getElementById("app"),ie.createApp());
